import{r as s,c as i,h as t}from"./p-c0299936.js";const e=class{constructor(t){s(this,t),this.subscribed=i(this,"subscribed",7),this.show=!1,this.autoOpen=!0,this.trigger="",this.storeName="",this.ms=1e3,this.stores=[],this.email="",this.emailHelpText="",this.selectedStores=[],this.checkboxsGroupHelpText="",this.handleClose=()=>{this.open=!1},this.handleSkip=()=>{this.handleClose(),localStorage.setItem("SS","1")},this.inputChanged=s=>{this.email=s.target.value;let i=this.checkEmailValidity(this.email);!0===i?(this.emailHelpText="",this.isEmailValid=!0):(this.emailHelpText=i,this.isEmailValid=!1)},this.handleCheckboxChange=()=>{this.selectedStores=[].slice.call(this.checkboxsGroup.querySelectorAll("input:checked")).map((function(s){return s.value})),this.selectedStores.length>0?(this.isCheckboxsGroupValid=!0,this.checkboxsGroupHelpText=""):(this.isCheckboxsGroupValid=!1,this.checkboxsGroupHelpText="Store is required")},this.handlesubscribe=async()=>{if(!this.isCheckboxsGroupValid||!this.isEmailValid)return;const s={name:"",email:this.email,q:"",zipcode:"",type:"weekly ads"};s.q=this.selectedStores.join(", ").toLowerCase();const{zipCode:i}=await fetch("https://api.apply-now.io/api/v1/ip/current").then(s=>s.json());if(!i)throw new Error("Unable to get zipcode, please try again later.");s.zipcode=i;const{email:t}=await fetch("https://api.apply-now.io/api/v1/subscription/addq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(s=>s.json());localStorage.setItem("RU",t),this.handleSkip(),console.log("Successfully subscribed"),this.subscribed.emit(this.trigger);const e=document.createElement("verification-email-popup");e.email=t,document.body.appendChild(e)}}async componentWillLoad(){const s=[fetch("https://app.sprucejoy.com/api/v2/stores").then(s=>s.json()).then(({data:s})=>{this.stores=s})];if(this.autoOpen){const i=async function(s){await new Promise(i=>setTimeout(i,s))}(this.ms);s.push(i)}await Promise.all(s),this.autoOpen&&(this.open=!0)}watchHandler(s){this.open=!!s}checkEmailValidity(s){return s?!!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(s)||"Email must be valid":"Email is required"}render(){let s=this.isCheckboxsGroupValid&&this.isEmailValid;return t("div",{class:this.open?"modal is-active subscribe-modal":"modal subscribe-modal"},t("div",{onClick:this.handleClose,class:"modal-background"}),t("div",{class:"modal-card has-background-white"},t("div",{class:"modal-header"},t("div",{id:"gtag_weekly_ad_title",class:"header-content l-body has-text-weight-semibold"},"Never Miss a ",t("span",null,this.storeName)," Weekly Ad"),t("span",{onClick:this.handleSkip,class:"icon weeklyads-subscription-close-btn has-text-grey",style:{width:"22px",height:"22px"}},t("svg",{style:{width:"22px",height:"22px"},viewBox:"0 0 24 24"},t("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})))),t("div",{class:"modal-body"},t("div",{class:"field weeklyads-subscription-email-field"},t("div",{class:"control"},t("input",{onChange:this.inputChanged,class:{input:!0,"is-danger":!!this.emailHelpText},type:"email",placeholder:"Email",required:!0})),t("p",{class:{help:!0,"is-danger":!!this.emailHelpText}},this.emailHelpText)),t("div",{ref:s=>this.checkboxsGroup=s,class:"field weeklyads-subscription-stores-select"},t("div",{style:{maxHeight:"160px",overflow:"auto"}},this.stores.map(s=>t("div",{key:s.id,class:s.is_dmca_removal?"control is-hidden":"control"},t("label",{class:"checkbox"},t("input",{class:"mr-2",onChange:this.handleCheckboxChange,type:"checkbox",value:s.name,checked:this.storeName===s.name}),s.name)))),t("p",{class:{help:!0,"is-danger":!!this.checkboxsGroupHelpText}},this.checkboxsGroupHelpText))),t("div",{class:"modal-footer"},t("button",{onClick:this.handlesubscribe,class:"button is-rounded is-fullwidth is-primary weeklyads-subscription-subscribe-btn",style:{backgroundColor:"#f96302"},disabled:!s},"Subscribe")),t("div",{class:"modal-attention"},'By clicking "subscribe", you agree to our ',t("a",{href:"https://www.everypayjoy.com/legal",target:"_blank"},"Terms of Use and Privacy Policy"),".")))}static get watchers(){return{show:["watchHandler"]}}};e.style=":host{display:block}.subscribe-modal .modal-card{max-width:350px;border-radius:4px}.subscribe-modal .modal-background{background-color:rgb(33, 33, 33);opacity:0.46}.subscribe-modal .modal-header{padding:16px 24px 28px;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap;word-break:normal}.subscribe-modal .modal-header .header-content{color:#000c14}.subscribe-modal .modal-header .header-content span{color:#37a000}.subscribe-modal .modal-body{width:100%;padding:0 24px}.subscribe-modal .modal-body .field .help{min-height:18px}.subscribe-modal .modal-footer{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;padding-right:24px;padding-left:24px;padding-top:0;padding-bottom:28px}.subscribe-modal .modal-attention{font-family:Noto Sans;font-style:normal;font-weight:400;font-size:11px;line-height:13px;letter-spacing:0.066px;padding-right:24px;padding-left:24px;padding-bottom:20px;color:#bdbdbd;caret-color:#bdbdbd}";export{e as subscribe_modal}
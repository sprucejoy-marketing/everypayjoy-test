var __awaiter=this&&this.__awaiter||function(e,t,i,s){function a(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,r){function n(e){try{l(s.next(e))}catch(t){r(t)}}function o(e){try{l(s["throw"](e))}catch(t){r(t)}}function l(e){e.done?i(e.value):a(e.value).then(n,o)}l((s=s.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var i={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},s,a,r,n;return n={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(n[Symbol.iterator]=function(){return this}),n;function o(e){return function(t){return l([e,t])}}function l(n){if(s)throw new TypeError("Generator is already executing.");while(i)try{if(s=1,a&&(r=n[0]&2?a["return"]:n[0]?a["throw"]||((r=a["return"])&&r.call(a),0):a.next)&&!(r=r.call(a,n[1])).done)return r;if(a=0,r)n=[n[0]&2,r.value];switch(n[0]){case 0:case 1:r=n;break;case 4:i.label++;return{value:n[1],done:false};case 5:i.label++;a=n[1];n=[0];continue;case 7:n=i.ops.pop();i.trys.pop();continue;default:if(!(r=i.trys,r=r.length>0&&r[r.length-1])&&(n[0]===6||n[0]===2)){i=0;continue}if(n[0]===3&&(!r||n[1]>r[0]&&n[1]<r[3])){i.label=n[1];break}if(n[0]===6&&i.label<r[1]){i.label=r[1];r=n;break}if(r&&i.label<r[2]){i.label=r[2];i.ops.push(n);break}if(r[2])i.ops.pop();i.trys.pop();continue}n=t.call(e,i)}catch(o){n=[6,o];a=0}finally{s=r=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:true}}};System.register(["./p-cdcacac3.system.js"],(function(e){"use strict";var t,i,s;return{setters:[function(e){t=e.r;i=e.c;s=e.h}],execute:function(){function a(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,e)}))];case 1:t.sent();return[2]}}))}))}var r=":host{display:block}.subscribe-modal .modal-card{max-width:350px;border-radius:4px}.subscribe-modal .modal-background{background-color:rgb(33, 33, 33);opacity:0.46}.subscribe-modal .modal-header{padding:16px 24px 28px;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-align:start;align-items:flex-start;-ms-flex-wrap:nowrap;flex-wrap:nowrap;word-break:normal}.subscribe-modal .modal-header .header-content{color:#000c14}.subscribe-modal .modal-header .header-content span{color:#37a000}.subscribe-modal .modal-body{width:100%;padding:0 24px}.subscribe-modal .modal-body .field .help{min-height:18px}.subscribe-modal .modal-footer{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;padding-right:24px;padding-left:24px;padding-top:0;padding-bottom:28px}.subscribe-modal .modal-attention{font-family:Noto Sans;font-style:normal;font-weight:400;font-size:11px;line-height:13px;letter-spacing:0.066px;padding-right:24px;padding-left:24px;padding-bottom:20px;color:#bdbdbd;caret-color:#bdbdbd}";var n=e("subscribe_modal",function(){function e(e){var s=this;t(this,e);this.subscribed=i(this,"subscribed",7);this.show=false;this.autoOpen=true;this.trigger="";this.storeName="";this.ms=1e3;this.stores=[];this.email="";this.emailHelpText="";this.selectedStores=[];this.checkboxsGroupHelpText="";this.handleClose=function(){s.open=false};this.handleSkip=function(){s.handleClose();localStorage.setItem("SS","1")};this.inputChanged=function(e){s.email=e.target.value;var t=s.checkEmailValidity(s.email);if(t===true){s.emailHelpText="";s.isEmailValid=true}else{s.emailHelpText=t;s.isEmailValid=false}};this.handleCheckboxChange=function(){s.selectedStores=[].slice.call(s.checkboxsGroup.querySelectorAll("input:checked")).map((function(e){return e.value}));if(s.selectedStores.length>0){s.isCheckboxsGroupValid=true;s.checkboxsGroupHelpText=""}else{s.isCheckboxsGroupValid=false;s.checkboxsGroupHelpText="Store is required"}};this.handlesubscribe=function(){return __awaiter(s,void 0,void 0,(function(){var e,t,i,s;return __generator(this,(function(a){switch(a.label){case 0:if(!this.isCheckboxsGroupValid||!this.isEmailValid)return[2];e={name:"",email:this.email,q:"",zipcode:"",type:""};e.type="weekly ads";e.q=this.selectedStores.join(", ").toLowerCase();return[4,fetch("https://api.apply-now.io/api/v1/ip/current").then((function(e){return e.json()}))];case 1:t=a.sent().zipCode;if(!t)throw new Error("Unable to get zipcode, please try again later.");e.zipcode=t;return[4,fetch("https://api.apply-now.io/api/v1/subscription/addq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()}))];case 2:i=a.sent().email;localStorage.setItem("RU",i);this.handleSkip();console.log("Successfully subscribed");this.subscribed.emit(this.trigger);s=document.createElement("verification-email-popup");s.email=i;document.body.appendChild(s);return[2]}}))}))}}e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;var i=this;return __generator(this,(function(s){switch(s.label){case 0:e=[fetch("https://app.sprucejoy.com/api/v2/stores").then((function(e){return e.json()})).then((function(e){var t=e.data;i.stores=t}))];if(this.autoOpen){t=a(this.ms);e.push(t)}return[4,Promise.all(e)];case 1:s.sent();if(this.autoOpen){this.open=true}return[2]}}))}))};e.prototype.watchHandler=function(e){if(e){this.open=true}else{this.open=false}};e.prototype.checkEmailValidity=function(e){if(!e)return"Email is required";var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!t.test(e))return"Email must be valid";return true};e.prototype.render=function(){var e=this;var t=this.isCheckboxsGroupValid&&this.isEmailValid;return s("div",{class:this.open?"modal is-active subscribe-modal":"modal subscribe-modal"},s("div",{onClick:this.handleClose,class:"modal-background"}),s("div",{class:"modal-card has-background-white"},s("div",{class:"modal-header"},s("div",{id:"gtag_weekly_ad_title",class:"header-content l-body has-text-weight-semibold"},"Never Miss a ",s("span",null,this.storeName)," Weekly Ad"),s("span",{onClick:this.handleSkip,class:"icon weeklyads-subscription-close-btn has-text-grey",style:{width:"22px",height:"22px"}},s("svg",{style:{width:"22px",height:"22px"},viewBox:"0 0 24 24"},s("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})))),s("div",{class:"modal-body"},s("div",{class:"field weeklyads-subscription-email-field"},s("div",{class:"control"},s("input",{onChange:this.inputChanged,class:{input:true,"is-danger":!!this.emailHelpText},type:"email",placeholder:"Email",required:true})),s("p",{class:{help:true,"is-danger":!!this.emailHelpText}},this.emailHelpText)),s("div",{ref:function(t){return e.checkboxsGroup=t},class:"field weeklyads-subscription-stores-select"},s("div",{style:{maxHeight:"160px",overflow:"auto"}},this.stores.map((function(t){return s("div",{key:t.id,class:t.is_dmca_removal?"control is-hidden":"control"},s("label",{class:"checkbox"},s("input",{class:"mr-2",onChange:e.handleCheckboxChange,type:"checkbox",value:t.name,checked:e.storeName===t.name}),t.name))}))),s("p",{class:{help:true,"is-danger":!!this.checkboxsGroupHelpText}},this.checkboxsGroupHelpText))),s("div",{class:"modal-footer"},s("button",{onClick:this.handlesubscribe,class:"button is-rounded is-fullwidth is-primary weeklyads-subscription-subscribe-btn",style:{backgroundColor:"#f96302"},disabled:!t},"Subscribe")),s("div",{class:"modal-attention"},'By clicking "subscribe", you agree to our ',s("a",{href:"https://www.everypayjoy.com/legal",target:"_blank"},"Terms of Use and Privacy Policy"),".")))};Object.defineProperty(e,"watchers",{get:function(){return{show:["watchHandler"]}},enumerable:false,configurable:true});return e}());n.style=r}}}));